<!DOCTYPE html>
<html>
<head>
	<title>JSON YAML-EDITOR</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
<div id="headarea">
<span class="title">JSON YAML-EDITOR</span>
<input type="text" class="lhs-json pastearea" placeholder="Paste A JSON" onchange="json_modify(this);this.value='';" />
<input type="button" class="copybtn" value="Copy edited A JSON" onclick="copyBJson()" />
<span class="linkarea">
<label><input type="checkbox" id="uesc" checked="checked" />\u encode</label> 
<a href="./index.html" target="_blank">New DIFF-MERGE</a>／
<a href="./single.html" target="_blank">New EDITOR</a>
</span>
</div>
<div id="editor"></div>
<div id="footerarea">
Powerd By <a href="https://github.com/nodeca/js-yaml" target="_blank">js-yaml</a>, <a href="https://github.com/Microsoft/monaco-editor" target="_blank">monaco-editor</a>　　<a href="http://ltside.com" target="_blank">ltside.com</a>
</div>
<script src="vendors/jquery/js/jquery-1.9.1.min.js"></script>
<script src="vendors/js-yaml/js/js-yaml.min.js" type="text/javascript" charset="utf-8"></script>
<script src="vendors/monaco-editor/min/vs/loader.js"></script>
<script>
	var editor;
	var lhsModel;
	
	require.config({ paths: { 'vs': 'vendors/monaco-editor/min/vs' }});
	require(['vs/editor/editor.main'], function() {

		editor = monaco.editor.create(document.getElementById('editor'), {
			enableSplitViewResizing: false
		});
		lhsModel = monaco.editor.createModel("A", 'yaml');
		lhsModel.updateOptions({tabSize: 2,folding: true});

		editor.setModel(lhsModel);

		$(window).resize();
	});

	function jtoy(val){
		try{
			return jsyaml.dump(JSON.parse(val.replace(/([^\\])\\t/g,"$1<<TAB>>").replace(/([^\\])\\t/g,"$1<<TAB>>").replace(/^\\t/g,"<<TAB>>"))).replace(/<<TAB>>/g,"\t");
		}catch(e){
			alert(e.message);
		}
	}
	function ytoj(val){
		$("#mode").val(["json"]).change();
		try{
			return JSON.stringify(jsyaml.load(val));
		}catch(e){
			alert(e.message);
		}
		prev_grep = "proc_ytoj();";
	}
	function copy_clipboard(val){
		
		var $temp = $("<input>");
		$("body").append($temp);
		$temp.val(val).select();
		document.execCommand("copy");
		$temp.remove();
		
	}

	function splash_msg(msg){
		var e = $("<div style='position:fixed;visibility:hiden;z-index:1000;padding:20px;font-size:40px;color:white;background-color:gray;'>"+msg+"</div>");
		var w = $(window);
		console.log(e.height());
		e.offset({top: (w.height() / 2) - (e.height() / 2), left: (w.width() / 2) - (e.width() / 2)}).appendTo("body").fadeIn();
		window.setTimeout(function(){ e.fadeOut().queue(function() { this.remove(); }); },2000);
	}

	function json_modify(e){
		if($(e).val()=="") return;
		if($(e).hasClass("lhs-json")){
			lhsModel.setValue(jtoy($(e).val()));
		}
	}

	function copyBJson(){
		copy_clipboard(unicodeEscape(ytoj(lhsModel.getValue())));
		splash_msg("Copied");
	}
	
	function unicodeEscape(str){
		if(!$("#uesc").prop("checked")) return str;
		var code, pref = {1: '\\x0', 2: '\\x', 3: '\\u0', 4: '\\u'};
		return str.replace(/[^\u0020-\u007e]/g, function(c) {
			return pref[(code = c.charCodeAt(0).toString(16)).length] + code;
		});
	}

	$(window).resize(function(){
		$("#editor").width($(window).width()).height($(window).height() - $('#headarea').outerHeight() - 30);
		editor.layout({width:$(window).width(),height:$(window).height() - $('#headarea').outerHeight() - 30});
	});
</script>
</body>
</html>